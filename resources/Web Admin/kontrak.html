<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manajemen Kontrak - Admin Panel</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <style>
        * { padding: 0; margin: 0; box-sizing: border-box; }
        .layout { display: grid; grid-template-columns: 20% 80%; min-height: 100vh; }
        .sidebar { background-color: #30364F; padding: 30px; color: #fff; }
        .nav-link-custom { color: #ccc; padding: 12px; text-decoration: none; display: block; border-radius: 5px; margin-bottom: 5px; transition: 0.3s; }
        .nav-link-custom:hover, .nav-link-custom.active { background-color: #404765; color: #fff; }
    </style>
</head>
<body>
    <main class="layout">
        <aside class="sidebar d-flex flex-column justify-content-between">
            
            <div>
                <h3 class="text-center mb-4">Admin Panel</h3>
                <div class="d-flex flex-column">
                    <a href="dashboard.html" class="nav-link-custom"><i class="bi bi-speedometer2 me-2"></i> Dasbor</a>
                    <a href="barang.html" class="nav-link-custom"><i class="bi bi-box-seam me-2"></i> Barang</a>
                    <a href="kontrak.html" class="nav-link-custom active"><i class="bi bi-file-earmark-text me-2"></i> Kontrak</a>
                    <a href="user.html" class="nav-link-custom"><i class="bi bi-people me-2"></i> User</a>
                    <a href="karyawan.html" class="nav-link-custom"><i class="bi bi-person-badge me-2"></i> Karyawan</a>
                    <a href="mobilisasi.html" class="nav-link-custom"><i class="bi bi-arrow-left-right me-2"></i> Mobilisasi</a>
                </div>
            </div>

            <div class="mt-auto user-panel">
                <div class="d-flex align-items-center mb-3">
                    <div class="bg-primary rounded-circle d-flex align-items-center justify-content-center me-2" style="width: 40px; height: 40px;">
                        <i class="bi bi-person-fill h5 m-0 text-white"></i>
                    </div>
                    <div>
                        <small class="d-block text-light" style="font-size: 0.75rem;">Login sebagai:</small>
                        <span class="fw-bold">Admin IT</span>
                    </div>
                </div>
                <button onclick="logout()" class="btn btn-danger w-100 btn-sm">
                    <i class="bi bi-box-arrow-right me-2"></i> Logout
                </button>
            </div>
        </aside>

        <div class="p-5" style="background-color: #f8f9fa;">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <div>
                    <h3>Master Data Kontrak</h3>
                    <p class="text-muted">Data referensi pengadaan barang dan vendor.</p>
                </div>
                <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#modalTambahKontrak">
                    <i class="bi bi-plus-lg"></i> Tambah Kontrak
                </button>
            </div>

            <div class="alert alert-info d-flex align-items-center mb-4" role="alert">
                <i class="bi bi-info-circle-fill me-2"></i>
                <div>
                    <strong>Catatan:</strong> Data kontrak digunakan sebagai referensi saat input barang. Pastikan Nomor Kontrak diisi sesuai dokumen SPK asli.
                </div>
            </div>

            <div class="card shadow-sm border-0">
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover align-middle mb-0">
                            <thead class="table-light">
                                <tr>
                                    <th class="ps-3">No. Kontrak / SPK</th>
                                    <th>Tahun</th>
                                    <th>Nama Vendor</th>
                                    <th>Pihak Pengada</th>
                                    <th>Keterangan</th>
                                    <th class="text-center">Aksi</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td class="ps-3 fw-bold">SPK/IT/001/2024</td>
                                    <td><span class="badge bg-primary">2024</span></td>
                                    <td>PT. Solusi Digital Abadi</td>
                                    <td>Divisi IT</td>
                                    <td class="text-muted small">Pengadaan Laptop Staff Batch 1</td>
                                    <td class="text-center">
                                        <button class="btn btn-sm btn-outline-info" onclick="showDetail('1')" title="Lihat Barang"><i class="bi bi-eye"></i></button>
                                        <button class="btn btn-sm btn-outline-warning" onclick="showEdit('1')" title="Edit"><i class="bi bi-pencil"></i></button>
                                        <button class="btn btn-sm btn-outline-danger" title="Hapus"><i class="bi bi-trash"></i></button>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="ps-3 fw-bold">SPK/GA/055/2023</td>
                                    <td><span class="badge bg-secondary">2023</span></td>
                                    <td>CV. Mebel Indah Jaya</td>
                                    <td>General Affair</td>
                                    <td class="text-muted small">Meja & Kursi Rapat Lt. 2</td>
                                    <td class="text-center">
                                        <button class="btn btn-sm btn-outline-info" onclick="showDetail('2')"><i class="bi bi-eye"></i></button>
                                        <button class="btn btn-sm btn-outline-warning" onclick="showEdit('2')"><i class="bi bi-pencil"></i></button>
                                        <button class="btn btn-sm btn-outline-danger"><i class="bi bi-trash"></i></button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <div class="modal fade" id="modalTambahKontrak" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Input Data Kontrak Baru</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="formKontrak">
                        <div class="mb-3">
                            <label class="form-label">Nomor Kontrak / SPK <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" placeholder="Contoh: SPK/IT/001/2024" required>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-8">
                                <label class="form-label">Nama Vendor <span class="text-danger">*</span></label>
                                <input type="text" class="form-control" placeholder="PT. Nama Vendor" required>
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">Tahun</label>
                                <input type="number" class="form-control" value="2024" required>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Pihak Pengada</label>
                            <input type="text" class="form-control" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Keterangan Proyek</label>
                            <textarea class="form-control" rows="3"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                    <button type="submit" form="formKontrak" class="btn btn-primary">Simpan Kontrak</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="modalEditKontrak" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-warning-subtle">
                    <h5 class="modal-title">Edit Data Kontrak</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="formEditKontrak">
                        <input type="hidden" id="edit_id_kontrak">
                        <div class="mb-3">
                            <label class="form-label">Nomor Kontrak</label>
                            <input type="text" class="form-control" id="edit_no_kontrak" required>
                        </div>
                        <div class="row mb-3">
                            <div class="col-md-8">
                                <label class="form-label">Nama Vendor</label>
                                <input type="text" class="form-control" id="edit_vendor" required>
                            </div>
                            <div class="col-md-4">
                                <label class="form-label">Tahun</label>
                                <input type="number" class="form-control" id="edit_tahun" required>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Pihak Pengada</label>
                            <input type="text" class="form-control" id="edit_pengada" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Keterangan</label>
                            <textarea class="form-control" id="edit_ket" rows="3"></textarea>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                    <button type="button" class="btn btn-primary" onclick="alert('Data Updated (Simulasi)')">Update Data</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="modalDetailKontrak" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <div>
                        <h5 class="modal-title">Detail Kontrak</h5>
                        <small class="text-muted" id="detail_no_header">SPK/XXX</small>
                    </div>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <table class="table table-borderless table-sm">
                                <tr>
                                    <td width="35%" class="text-secondary">Vendor</td>
                                    <td class="fw-bold" id="detail_vendor">PT. ABC</td>
                                </tr>
                                <tr>
                                    <td class="text-secondary">Tahun</td>
                                    <td class="fw-bold"><span class="badge bg-primary" id="detail_tahun">2024</span></td>
                                </tr>
                            </table>
                        </div>
                        <div class="col-md-6">
                            <table class="table table-borderless table-sm">
                                <tr>
                                    <td width="35%" class="text-secondary">Pengada</td>
                                    <td class="fw-bold" id="detail_pengada">Divisi IT</td>
                                </tr>
                                <tr>
                                    <td class="text-secondary">Ket</td>
                                    <td class="fst-italic" id="detail_ket">...</td>
                                </tr>
                            </table>
                        </div>
                    </div>

                    <h6 class="border-bottom pb-2 mb-3">Daftar Aset dalam Kontrak Ini</h6>
                    <div class="table-responsive">
                        <table class="table table-striped table-sm align-middle">
                            <thead class="table-light">
                                <tr>
                                    <th>Kode Barcode</th>
                                    <th>Nama Barang</th>
                                    <th>Qty</th>
                                    <th>Kondisi</th>
                                </tr>
                            </thead>
                            <tbody id="detail_list_barang">
                                </tbody>
                        </table>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Tutup</button>
                    <button type="button" class="btn btn-warning" onclick="switchModalToEdit()">Edit Kontrak</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // 1. DATABASE SIMULASI (Kontrak + Barang didalamnya)
        const databaseKontrak = {
            '1': {
                id: '1', no: 'SPK/IT/001/2024', vendor: 'PT. Solusi Digital Abadi', 
                tahun: 2024, pengada: 'Divisi IT', ket: 'Pengadaan Laptop Staff Batch 1',
                items: [
                    { barcode: 'LP-DELL-001', nama: 'Laptop Dell Latitude 5420', qty: 1, kondisi: 'Baik' },
                    { barcode: 'LP-DELL-002', nama: 'Laptop Dell Latitude 5420', qty: 1, kondisi: 'Baik' },
                    { barcode: 'LP-DELL-003', nama: 'Laptop Dell Latitude 5420', qty: 1, kondisi: 'Rusak Ringan' },
                    { barcode: 'MS-LOGI-001', nama: 'Mouse Logitech Wireless', qty: 5, kondisi: 'Baik' }
                ]
            },
            '2': {
                id: '2', no: 'SPK/GA/055/2023', vendor: 'CV. Mebel Indah Jaya', 
                tahun: 2023, pengada: 'General Affair', ket: 'Meja & Kursi Rapat Lt. 2',
                items: [
                    { barcode: 'MEJA-RPT-01', nama: 'Meja Rapat Panjang Kayu Jati', qty: 1, kondisi: 'Baik' },
                    { barcode: 'KURSI-RPT-0A', nama: 'Kursi Rapat Hidrolik', qty: 12, kondisi: 'Baik' }
                ]
            }
        };

        // 2. LOGIKA TAMPIL DETAIL
        function showDetail(id) {
            const data = databaseKontrak[id];

            // Isi Header & Info
            document.getElementById('detail_no_header').innerText = data.no;
            document.getElementById('detail_vendor').innerText = data.vendor;
            document.getElementById('detail_tahun').innerText = data.tahun;
            document.getElementById('detail_pengada').innerText = data.pengada;
            document.getElementById('detail_ket').innerText = data.ket;

            // Isi Tabel Barang (Looping)
            const tbody = document.getElementById('detail_list_barang');
            tbody.innerHTML = ''; // Reset isi tabel
            
            if(data.items.length > 0){
                data.items.forEach(item => {
                    const row = `
                        <tr>
                            <td class="fw-bold font-monospace">${item.barcode}</td>
                            <td>${item.nama}</td>
                            <td>${item.qty} Unit</td>
                            <td><span class="badge bg-${item.kondisi === 'Baik' ? 'success' : 'warning'} text-wrap" style="width: 80px;">${item.kondisi}</span></td>
                        </tr>
                    `;
                    tbody.innerHTML += row;
                });
            } else {
                tbody.innerHTML = '<tr><td colspan="4" class="text-center text-muted">Belum ada barang terdaftar di kontrak ini.</td></tr>';
            }

            // Simpan ID sementara untuk tombol edit
            document.getElementById('edit_id_kontrak').value = id;

            // Tampilkan Modal
            new bootstrap.Modal(document.getElementById('modalDetailKontrak')).show();
        }

        // 3. LOGIKA TAMPIL EDIT
        function showEdit(id) {
            const data = databaseKontrak[id];

            document.getElementById('edit_id_kontrak').value = data.id;
            document.getElementById('edit_no_kontrak').value = data.no;
            document.getElementById('edit_vendor').value = data.vendor;
            document.getElementById('edit_tahun').value = data.tahun;
            document.getElementById('edit_pengada').value = data.pengada;
            document.getElementById('edit_ket').value = data.ket;

            // Tutup modal detail jika terbuka
            const detailModalEl = document.getElementById('modalDetailKontrak');
            const detailModal = bootstrap.Modal.getInstance(detailModalEl);
            if(detailModal) detailModal.hide();

            new bootstrap.Modal(document.getElementById('modalEditKontrak')).show();
        }

        // Shortcut dari Detail ke Edit
        function switchModalToEdit() {
            const id = document.getElementById('edit_id_kontrak').value;
            showEdit(id);
        }
        function logout() {
            if(confirm("Apakah Anda yakin ingin keluar dari sistem?")) {
                // Di sini nanti arahkan ke file login.php atau login.html
                alert("Anda berhasil logout!");
                window.location.href = "login.html"; 
            }
        }
    </script>
</body>
</html>