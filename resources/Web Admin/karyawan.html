<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Manajemen Karyawan - Admin Panel</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <style>
        * { padding: 0; margin: 0; box-sizing: border-box; }
        .layout { display: grid; grid-template-columns: 20% 80%; min-height: 100vh; }
        .sidebar { background-color: #30364F; padding: 30px; color: #fff; }
        .nav-link-custom { color: #ccc; padding: 12px; text-decoration: none; display: block; border-radius: 5px; margin-bottom: 5px; transition: 0.3s; }
        .nav-link-custom:hover, .nav-link-custom.active { background-color: #404765; color: #fff; }
    </style>
</head>
<body>
    <main class="layout">
        <aside class="sidebar d-flex flex-column justify-content-between">
            
            <div>
                <h3 class="text-center mb-4">Admin Panel</h3>
                <div class="d-flex flex-column">
                    <a href="dashboard.html" class="nav-link-custom"><i class="bi bi-speedometer2 me-2"></i> Dasbor</a>
                    <a href="barang.html" class="nav-link-custom"><i class="bi bi-box-seam me-2"></i> Barang</a>
                    <a href="kontrak.html" class="nav-link-custom"><i class="bi bi-file-earmark-text me-2"></i> Kontrak</a>
                    <a href="user.html" class="nav-link-custom"><i class="bi bi-people me-2"></i> User</a>
                    <a href="karyawan.html" class="nav-link-custom active"><i class="bi bi-person-badge me-2"></i> Karyawan</a>
                    <a href="mobilisasi.html" class="nav-link-custom"><i class="bi bi-arrow-left-right me-2"></i> Mobilisasi</a>
                </div>
            </div>

            <div class="mt-auto user-panel">
                <div class="d-flex align-items-center mb-3">
                    <div class="bg-primary rounded-circle d-flex align-items-center justify-content-center me-2" style="width: 40px; height: 40px;">
                        <i class="bi bi-person-fill h5 m-0 text-white"></i>
                    </div>
                    <div>
                        <small class="d-block text-light" style="font-size: 0.75rem;">Login sebagai:</small>
                        <span class="fw-bold">Admin IT</span>
                    </div>
                </div>
                <button onclick="logout()" class="btn btn-danger w-100 btn-sm">
                    <i class="bi bi-box-arrow-right me-2"></i> Logout
                </button>
            </div>
        </aside>

        <div class="p-5" style="background-color: #f8f9fa;">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <div>
                    <h3>Master Data Karyawan</h3>
                    <p class="text-muted">Database personil perusahaan penerima fasilitas aset.</p>
                </div>
                <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#modalTambahKaryawan">
                    <i class="bi bi-person-plus"></i> Tambah Karyawan
                </button>
            </div>

            <div class="row mb-4">
                <div class="col-md-4">
                    <div class="card border-0 shadow-sm p-3">
                        <div class="d-flex align-items-center">
                            <div class="bg-primary text-white rounded-circle p-3 me-3">
                                <i class="bi bi-people-fill h4 mb-0"></i>
                            </div>
                            <div>
                                <h6 class="text-muted mb-0">Total Pegawai</h6>
                                <h4 class="mb-0">45 Orang</h4>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card shadow-sm border-0">
                <div class="card-body p-0">
                    <div class="table-responsive">
                        <table class="table table-hover align-middle mb-0">
                            <thead class="table-light">
                                <tr>
                                    <th class="ps-3">NIK</th>
                                    <th>Nama Lengkap</th>
                                    <th>Jabatan / Divisi</th>
                                    <th>Kontak (WA)</th>
                                    <th>Tanggungan Aset</th>
                                    <th class="text-center">Aksi</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td class="ps-3 fw-bold">2024001</td>
                                    <td>Ahmad Zulkarnain</td>
                                    <td>IT Manager <span class="badge bg-secondary ms-1">IT</span></td>
                                    <td>0812-3456-7890</td>
                                    <td><span class="badge bg-warning text-dark">3 Barang</span></td>
                                    <td class="text-center">
                                        <button class="btn btn-sm btn-outline-info" onclick="showDetail('1')" title="Lihat Aset"><i class="bi bi-eye"></i></button>
                                        <button class="btn btn-sm btn-outline-warning" onclick="showEdit('1')" title="Edit"><i class="bi bi-pencil"></i></button>
                                        <button class="btn btn-sm btn-outline-danger" onclick="hapusData('Ahmad Zulkarnain', 3)"><i class="bi bi-trash"></i></button>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="ps-3 fw-bold">2024012</td>
                                    <td>Siti Aminah</td>
                                    <td>Staff Finance <span class="badge bg-secondary ms-1">FIN</span></td>
                                    <td>0857-1122-3344</td>
                                    <td><span class="badge bg-primary">1 Barang</span></td>
                                    <td class="text-center">
                                        <button class="btn btn-sm btn-outline-info" onclick="showDetail('2')" title="Lihat Aset"><i class="bi bi-eye"></i></button>
                                        <button class="btn btn-sm btn-outline-warning" onclick="showEdit('2')" title="Edit"><i class="bi bi-pencil"></i></button>
                                        <button class="btn btn-sm btn-outline-danger" onclick="hapusData('Siti Aminah', 1)"><i class="bi bi-trash"></i></button>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="ps-3 fw-bold">2024055</td>
                                    <td>Budi Santoso</td>
                                    <td>General Affair <span class="badge bg-secondary ms-1">GA</span></td>
                                    <td>0813-9988-7766</td>
                                    <td><span class="badge bg-secondary">0 Barang</span></td>
                                    <td class="text-center">
                                        <button class="btn btn-sm btn-outline-secondary disabled" title="Tidak ada aset"><i class="bi bi-eye-slash"></i></button>
                                        <button class="btn btn-sm btn-outline-warning" onclick="showEdit('3')" title="Edit"><i class="bi bi-pencil"></i></button>
                                        <button class="btn btn-sm btn-outline-danger" onclick="hapusData('Budi Santoso', 0)"><i class="bi bi-trash"></i></button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <div class="modal fade" id="modalTambahKaryawan" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Input Data Karyawan</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="formKaryawan">
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label class="form-label">NIK (Nomor Induk)</label>
                                <input type="text" class="form-control" placeholder="Contoh: 2024001" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">No. Telepon / WA</label>
                                <input type="text" class="form-control" placeholder="08xx-xxxx-xxxx">
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Nama Lengkap</label>
                            <input type="text" class="form-control" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Jabatan / Posisi</label>
                            <input type="text" class="form-control" placeholder="Contoh: Staff Gudang" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Departemen</label>
                            <select class="form-select">
                                <option value="">Pilih Departemen...</option>
                                <option value="IT">Teknologi Informasi</option>
                                <option value="HR">Human Resource</option>
                                <option value="GA">General Affair</option>
                                <option value="FIN">Finance</option>
                                <option value="OPS">Operasional</option>
                            </select>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                    <button type="submit" form="formKaryawan" class="btn btn-primary">Simpan Data</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="modalEditKaryawan" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-warning-subtle">
                    <h5 class="modal-title">Edit Data Karyawan</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="formEditKaryawan">
                        <input type="hidden" id="edit_id_karyawan">
                        
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label class="form-label">NIK (Readonly)</label>
                                <input type="text" class="form-control bg-light" id="edit_nik" readonly>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">No. Telepon / WA</label>
                                <input type="text" class="form-control" id="edit_telp">
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Nama Lengkap</label>
                            <input type="text" class="form-control" id="edit_nama" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Jabatan / Posisi</label>
                            <input type="text" class="form-control" id="edit_jabatan" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Departemen</label>
                            <select class="form-select" id="edit_dept">
                                <option value="IT">Teknologi Informasi</option>
                                <option value="HR">Human Resource</option>
                                <option value="GA">General Affair</option>
                                <option value="FIN">Finance</option>
                                <option value="OPS">Operasional</option>
                            </select>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Batal</button>
                    <button type="button" class="btn btn-primary" onclick="alert('Data Berhasil Diupdate (Simulasi)')">Simpan Perubahan</button>
                </div>
            </div>
        </div>
    </div>

    <div class="modal fade" id="modalDetailKaryawan" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <div>
                        <h5 class="modal-title" id="detail_header_nama">Nama Karyawan</h5>
                        <small class="text-muted" id="detail_header_jabatan">Jabatan</small>
                    </div>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="row mb-4 border-bottom pb-3">
                        <div class="col-md-4">
                            <span class="text-muted small d-block">NIK</span>
                            <span class="fw-bold" id="detail_nik">2024xxx</span>
                        </div>
                        <div class="col-md-4">
                            <span class="text-muted small d-block">Departemen</span>
                            <span class="badge bg-secondary" id="detail_dept">IT</span>
                        </div>
                        <div class="col-md-4">
                            <span class="text-muted small d-block">Kontak</span>
                            <span class="fw-bold" id="detail_telp">08xx</span>
                        </div>
                    </div>

                    <h6 class="fw-bold mb-3"><i class="bi bi-box-seam me-2"></i>Daftar Aset yang Sedang Dipegang</h6>
                    <div class="alert alert-info small">
                        <i class="bi bi-info-circle me-1"></i>
                        Barang-barang di bawah ini adalah tanggung jawab penuh karyawan yang bersangkutan.
                    </div>
                    <div class="table-responsive">
                        <table class="table table-striped table-sm align-middle">
                            <thead class="table-light">
                                <tr>
                                    <th>Kode Barcode</th>
                                    <th>Nama Barang</th>
                                    <th>Kondisi Terakhir</th>
                                    <th>Tgl Terima</th>
                                </tr>
                            </thead>
                            <tbody id="list_aset_karyawan">
                                </tbody>
                        </table>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Tutup</button>
                    <button type="button" class="btn btn-warning" onclick="switchModalToEdit()">Edit Profil</button>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // 1. DATA DUMMY KARYAWAN + RELASI ASET
        const databaseKaryawan = {
            '1': {
                id: '1', nik: '2024001', nama: 'Ahmad Zulkarnain', jabatan: 'IT Manager', 
                dept: 'IT', telp: '0812-3456-7890',
                assets: [
                    { barcode: 'LP-DELL-001', nama: 'Laptop Dell Latitude 5420', kondisi: 'Baik', tgl: '10 Jan 2024' },
                    { barcode: 'MS-LOGI-005', nama: 'Mouse Logitech MX Master', kondisi: 'Baik', tgl: '10 Jan 2024' },
                    { barcode: 'HDD-EXT-01', nama: 'HDD External 1TB', kondisi: 'Rusak Ringan', tgl: '15 Feb 2024' }
                ]
            },
            '2': {
                id: '2', nik: '2024012', nama: 'Siti Aminah', jabatan: 'Staff Finance', 
                dept: 'FIN', telp: '0857-1122-3344',
                assets: [
                    { barcode: 'PC-LENOVO-02', nama: 'PC All in One Lenovo', kondisi: 'Baik', tgl: '01 Mar 2024' }
                ]
            },
            '3': {
                id: '3', nik: '2024055', nama: 'Budi Santoso', jabatan: 'General Affair', 
                dept: 'GA', telp: '0813-9988-7766',
                assets: [] // Tidak punya aset
            }
        };

        // 2. FUNGSI TAMPIL DETAIL
        function showDetail(id) {
            const data = databaseKaryawan[id];

            // Isi Header & Profil
            document.getElementById('detail_header_nama').innerText = data.nama;
            document.getElementById('detail_header_jabatan').innerText = data.jabatan;
            document.getElementById('detail_nik').innerText = data.nik;
            document.getElementById('detail_dept').innerText = data.dept;
            document.getElementById('detail_telp').innerText = data.telp;

            // Isi Tabel Aset
            const tbody = document.getElementById('list_aset_karyawan');
            tbody.innerHTML = ''; // Reset

            if (data.assets.length > 0) {
                data.assets.forEach(item => {
                    const row = `
                        <tr>
                            <td class="font-monospace fw-bold">${item.barcode}</td>
                            <td>${item.nama}</td>
                            <td><span class="badge bg-${item.kondisi === 'Baik' ? 'success' : 'warning'}">${item.kondisi}</span></td>
                            <td>${item.tgl}</td>
                        </tr>
                    `;
                    tbody.innerHTML += row;
                });
            } else {
                tbody.innerHTML = '<tr><td colspan="4" class="text-center text-muted fst-italic py-3">Tidak ada aset yang sedang dipegang.</td></tr>';
            }

            // Simpan ID untuk switch edit
            document.getElementById('edit_id_karyawan').value = id;

            new bootstrap.Modal(document.getElementById('modalDetailKaryawan')).show();
        }

        // 3. FUNGSI TAMPIL EDIT
        function showEdit(id) {
            const data = databaseKaryawan[id];

            document.getElementById('edit_id_karyawan').value = data.id;
            document.getElementById('edit_nik').value = data.nik;
            document.getElementById('edit_nama').value = data.nama;
            document.getElementById('edit_jabatan').value = data.jabatan;
            document.getElementById('edit_telp').value = data.telp;
            document.getElementById('edit_dept').value = data.dept;

            // Tutup detail, buka edit
            const detailModalEl = document.getElementById('modalDetailKaryawan');
            const detailModal = bootstrap.Modal.getInstance(detailModalEl);
            if(detailModal) detailModal.hide();

            new bootstrap.Modal(document.getElementById('modalEditKaryawan')).show();
        }

        function switchModalToEdit() {
            const id = document.getElementById('edit_id_karyawan').value;
            showEdit(id);
        }

        // 4. LOGIKA HAPUS (Safety Check)
        function hapusData(nama, jumlahAset) {
            if (jumlahAset > 0) {
                // Cegah Hapus jika masih pegang aset
                alert(`GAGAL MENGHAPUS!\n\nKaryawan atas nama "${nama}" masih memegang ${jumlahAset} aset barang.\nSilakan lakukan serah terima aset (Mobilisasi) terlebih dahulu sebelum menghapus data karyawan.`);
            } else {
                // Boleh hapus
                if(confirm(`Apakah Anda yakin ingin menghapus data "${nama}"?`)) {
                    alert('Data berhasil dihapus (Simulasi).');
                }
            }
        }
        function logout() {
            if(confirm("Apakah Anda yakin ingin keluar dari sistem?")) {
                // Di sini nanti arahkan ke file login.php atau login.html
                alert("Anda berhasil logout!");
                window.location.href = "login.html"; 
            }
        }
    </script>
</body>
</html>